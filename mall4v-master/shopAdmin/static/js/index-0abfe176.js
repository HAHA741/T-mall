import{a as W,w as Te,x as Ne,f as Ie,y as pe,z as ie,b as le,A as _e,B as ge,C as ve,e as de,c as me,D as he,F as Se,d as Ue,G as $e,H as Ce,I as Le,J as Pe}from"./element-plus@2.3.6_vue@3.2.47-2ccbbec5.js";import{_ as Ee}from"./index-ea4cc5c2.js";import{$ as Me}from"./vue-cookies@1.8.3-b35a0960.js";import{h as _,_ as be,i as je,t as xe}from"./index-ac6793f4.js";import{r as L,u as s,i as Ve,j as Oe}from"./@vue_reactivity@3.2.47-b35eb3c0.js";import{t as Y,Y as Fe,o as d,c as I,e as l,L as a,a as ce,x as fe,f as oe,F as K,W as z,K as x,P as j,O as B,M as Z,n as ke,am as De,al as Re}from"./@vue_runtime-core@3.2.47-7772318f.js";import{b as Ae,v as ee}from"./@vue_runtime-dom@3.2.47-65c92196.js";import{O as q}from"./@vue_shared@3.2.47-804b7488.js";import{d as Be}from"./pinia@2.0.33_vue@3.2.47-da3f2561.js";import{_ as qe}from"./index-edf54585.js";import{D as Ke}from"./debounce-d39f6322.js";import{a as ze,u as Ge}from"./vue-router@4.1.6_vue@3.2.47-3725844c.js";import"./lodash-es@4.17.21-53d52778.js";import"./@vue-eb92069c.js";import"./@ctrl_tinycolor@3.6.1-93e5f6fc.js";import"./@vueuse_core@9.13.0_vue@3.2.47-f8689e2f.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-4c633672.js";import"./@element-plus_icons-vue@2.1.0_vue@3.2.47-c959b2bd.js";import"./@sxzz_popperjs-es@2.11.7-eb0a044a.js";import"./dayjs@1.11.13-e8f4b8a8.js";import"./async-validator@4.2.5-940bb5fd.js";import"./memoize-one@6.0.0-43ba193c.js";import"./escape-html@1.0.3-d65727e0.js";import"./normalize-wheel-es@1.2.0-fb80f16a.js";import"./@floating-ui_dom@1.6.12-11ac7818.js";import"./@floating-ui_core@1.6.8-010b5758.js";import"./@floating-ui_utils@0.2.8-6db9c233.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-d8bd5cdb.js";import"./vue@3.2.47-3eac09d8.js";import"./moment@2.29.4-4717c495.js";import"./axios@1.3.4-4a7005d9.js";import"./qs@6.11.1-8e85f023.js";import"./side-channel@1.0.6-025da103.js";import"./get-intrinsic@1.2.4-25c259ca.js";import"./es-errors@1.3.0-82fd953f.js";import"./has-symbols@1.0.3-8f82dcae.js";import"./has-proto@1.0.3-1353c55e.js";import"./function-bind@1.1.2-61637ca6.js";import"./hasown@2.0.2-42bc0a75.js";import"./call-bind@1.0.7-82cb89a2.js";import"./set-function-length@1.2.2-7418ecdf.js";import"./define-data-property@1.1.4-53ade537.js";import"./es-define-property@1.0.0-8178d4b8.js";import"./gopd@1.0.1-6433dd40.js";import"./has-property-descriptors@1.0.2-f195ed7c.js";import"./object-inspect@1.13.3-0d0634c3.js";import"./crypto-js@4.1.1-0f0eb29b.js";import"./lodash@4.17.21-08c1e7a6.js";import"./@smallwei_avue@3.5.6_element-plus@2.3.6_vue@3.2.47-c4df20a4.js";import"./vue-demi@0.14.10_vue@3.2.47-71ba0ef2.js";const He=["src"],Je={__name:"index",props:{modelValue:{default:"",type:String}},emits:["update:modelValue"],setup(w,{emit:O}){const C=w,o={Authorization:Me.get("Authorization")},U=_.adornUrl("/admin/file/upload/element"),$=L(""),b=L(!1),S="https://img.mall4j.com/",R=Y(()=>{var u;const f=[];if(C.modelValue){const m=(u=C.modelValue)==null?void 0:u.split(",");for(let V=0;V<m.length;V++)f.push({url:S+m[V],response:m[V]})}return O("update:modelValue",C.modelValue),f}),g=(f,u,m)=>{const V=m.map(t=>typeof t.response=="string"?t.response:t.response.data).join(",");O("update:modelValue",V)},E=f=>{const u=f.type==="image/jpeg"||f.type==="image/png"||f.type==="image/gif"||f.type==="image/jpg";u||W.error("上传图片只能是jpeg/jpg/png/gif 格式!");const m=f.size/1024/1024<2;return m||W.error("上传图片大小不能超过 2MB!"),m&&u},F=(f,u)=>{const m=u.map(V=>typeof V.response=="string"?V.response:V.response.data).join(",");O("update:modelValue",m)},y=f=>{$.value=f.url,b.value=!0};return(f,u)=>{const m=Fe("Plus"),V=Te,t=Ne,n=Ie;return d(),I("div",null,[l(t,{action:s(U),headers:o,"list-type":"picture-card","on-preview":y,"on-remove":F,"on-success":g,"file-list":s(R),"before-upload":E},{default:a(()=>[l(V,null,{default:a(()=>[l(m)]),_:1})]),_:1},8,["action","file-list"]),l(n,{modelValue:s(b),"onUpdate:modelValue":u[0]||(u[0]=i=>Ve(b)?b.value=i:null)},{default:a(()=>[ce("img",{width:"100%",src:s($),alt:""},null,8,He)]),_:1},8,["modelValue"])])}}},We={class:"mod-prod-prod-transport"},Ye={key:0},Qe={key:0},Xe={key:1},Ze={key:2},et={key:0},tt={key:1},lt={key:2},ot={__name:"prod-transport",props:{modelValue:{default:null,type:Number}},emits:["input","update:modelValue"],setup(w,{emit:O}){const C=w,o=L(null),U=Y(()=>{const g=[["首件(个)","运费(元)","续件(个)","续费(元)"],["首重(kg)","运费(元)","续重(kg)","续费(元)"],["首体积(m³)","运费(元)","续体积(m³)","续费(元)"]];return S.value.chargeType?g[S.value.chargeType]:g[0]});fe(()=>C.modelValue,g=>{o.value=g}),oe(()=>{b()});const $=L([{transportId:null,transName:""}]),b=()=>{_({url:_.adornUrl("/shop/transport/list"),method:"get",params:_.adornParams({})}).then(({data:g})=>{$.value=g})},S=L({hasFreeCondition:!1,transfeeFrees:[{freeCityList:[]}]}),R=g=>{O("update:modelValue",g),g&&_({url:_.adornUrl(`/shop/transport/info/${o.value}`),method:"get",params:_.adornParams({})}).then(({data:E})=>{S.value=E})};return(g,E)=>{const F=pe,y=ie,f=le,u=_e,m=ge,V=ve;return d(),I("div",We,[l(f,{label:"运费设置",rules:[{required:!0,message:"运费模板不能为空"}]},{default:a(()=>[l(y,{modelValue:s(o),"onUpdate:modelValue":E[0]||(E[0]=t=>Ve(o)?o.value=t:null),placeholder:"请选择",onChange:R},{default:a(()=>[(d(!0),I(K,null,z(s($),t=>(d(),x(F,{key:t.transportId,label:t.transName,value:t.transportId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:a(()=>[s(S).transfees?(d(),x(V,{key:0,data:s(S).transfees,style:{width:"100%"}},{default:a(()=>[l(m,{label:"配送区域",width:"350"},{default:a(t=>[t.row.cityList.length?(d(!0),I(K,{key:1},z(t.row.cityList,n=>(d(),x(u,{key:n.areaId},{default:a(()=>[j(q(n.areaName),1)]),_:2},1024))),128)):(d(),I("span",Ye,"所有地区"))]),_:1}),l(m,{prop:"firstPiece",label:s(U)[0]},null,8,["label"]),l(m,{prop:"firstFee",label:s(U)[1]},null,8,["label"]),l(m,{prop:"continuousPiece",label:s(U)[2]},null,8,["label"]),l(m,{prop:"continuousFee",label:s(U)[3]},null,8,["label"])]),_:1},8,["data"])):B("",!0)]),_:1}),s(S).hasFreeCondition===1?(d(),x(f,{key:0},{default:a(()=>[l(V,{data:s(S).transfeeFrees,style:{width:"100%"}},{default:a(()=>[l(m,{label:"指定区域",width:"350"},{default:a(t=>[(d(!0),I(K,null,z(t.row.freeCityList,n=>(d(),x(u,{key:n.areaId},{default:a(()=>[j(q(n.areaName),1)]),_:2},1024))),128))]),_:1}),l(m,{prop:"freeType",label:"包邮条件"},{default:a(t=>[t.row.freeType===0?(d(),I("span",Qe,"满件/重量/体积包邮")):B("",!0),t.row.freeType===1?(d(),I("span",Xe,"满金额包邮")):B("",!0),t.row.freeType===2?(d(),I("span",Ze,"满件/重量/体积且满金额包邮")):B("",!0)]),_:1}),l(m,{prop:"amount"},{default:a(t=>[t.row.freeType===1?(d(),I("span",et,"满"+q(t.row.amount)+"元金额包邮",1)):B("",!0),t.row.freeType===0?(d(),I("span",tt,"满"+q(t.row.piece)+"件/重量/体积包邮",1)):B("",!0),t.row.freeType===2?(d(),I("span",lt,"满"+q(t.row.piece)+"件/重量/体积且满"+q(t.row.amount)+"元金额包邮",1)):B("",!0)]),_:1})]),_:1},8,["data"])]),_:1})):B("",!0)])}}},ye=Be("prod",{state:()=>({id:0,skuTags:[],defalutSku:{price:0,oriPrice:0,stocks:0,properties:"",skuName:"",prodName:"",weight:0,volume:0,status:1}}),actions:{updateSkuTags(w){this.skuTags=w},addSkuTag(w){this.skuTags.push(w)},removeSkuTag(w){this.skuTags.splice(w,1)},removeSkuTagItem(w,O){this.skuTags[w].tagItems.splice(O,1)},addSkuTagItem({tagIndex:w,tagItem:O}){this.skuTags[w].tagItems.push(O)}}});const at=w=>(De("data-v-e44b7051"),w=w(),Re(),w),st={class:"mod-prod-sku-tag"},rt=at(()=>ce("br",null,null,-1)),nt={__name:"sku-tag",props:{skuList:{type:Array,default:()=>[]}},emits:["change"],setup(w,{expose:O,emit:C}){const o=w,U=ye(),$=L(!1),b=L({propName:"",selectValues:[]}),S=L(0),R=L(""),g=L([]),E=L([]),F=L([]);let y="",f=0,u=0,m=0,V=!1;const t=Y({get(){return U.skuTags},set(e){U.updateSkuTags(e)}}),n=Y(()=>{var r;const e=[];for(let c=0;c<F.value.length;c++){const v=F.value[c];((r=t.value)==null?void 0:r.findIndex(h=>h.tagName===v.propName))===-1&&e.push(v)}return e}),i=Y(()=>U.defalutSku);fe(()=>t.value,e=>{var c;if(V){V=!1;return}let r=[];if(S.value===4)(c=o.skuList)==null||c.forEach(v=>{const T=v.properties.split(";");R.value!==T[f].split(":")[1]&&r.push(v)});else if(S.value===2){const v=y+":"+R.value;let T=[];e==null||e.forEach(h=>{if(r.length===0){if(y===h.tagName){const k=Object.assign({},i.value);k.properties=v,r.push(k)}else h.tagItems.forEach(k=>{const M=Object.assign({},i.value);M.properties=`${h.tagName}:${k.propValue}`,r.push(M)});e.length===1&&(r=o.skuList.concat(r))}else T=[],y===h.tagName?r.forEach(k=>{if(k.properties.indexOf(y)===-1){const M=Object.assign({},k);M.properties=`${k.properties};${v}`,T.push(M)}}):h.tagItems.forEach(k=>{r.forEach(M=>{if(M.properties.indexOf(h.tagName)===-1){const J=Object.assign({},M);J.properties=`${M.properties};${h.tagName}:${k.propValue}`,T.push(J)}})}),r=o.skuList.concat(T)})}else{let v=[];e==null||e.forEach(T=>{r.length===0?T.tagItems.forEach(h=>{const k=Object.assign({},i.value);k.properties=`${T.tagName}:${h.propValue}`,r.push(k)}):(v=[],T.tagItems.forEach(h=>{r.forEach(k=>{const M=Object.assign({},k);M.properties=`${k.properties};${T.tagName}:${h.propValue}`,v.push(M)})}),r=v)})}r.length||r.push(Object.assign({},i.value)),C("change",r)},{deep:!0}),oe(()=>{_({url:_.adornUrl("/prod/spec/list"),method:"get",params:_.adornParams()}).then(({data:e})=>{F.value=e,e?m=Math.max.apply(Math,e.map(r=>r.propId)):m=0}),_({url:_.adornUrl("/prod/spec/listSpecMaxValueId"),method:"get",params:_.adornParams()}).then(({data:e})=>{e?u=e:u=0})}),O({init:e=>{if(!e||!e.length){t.value=[],C("change",[Object.assign({},i.value)]);return}V=!0;const r=[];for(let c=0;c<e.length;c++){const v=e[c];if(!v.properties)break;const T=v.properties.split(";");for(const h in T){const k=T[h].split(":");r[h]||(r[h]={tagName:k[0],tagItems:[]},g.value.push({visible:!1,value:""})),r[h].tagItems.findIndex(J=>J.propValue===k[1])===-1&&r[h].tagItems.push({propValue:k[1]})}}t.value=r}});const p=()=>{$.value=!0},N=()=>{$.value=!1,H()},Q=()=>{const e=b.value.selectValues;if(!b.value.propName){W.error("请输入规格名");return}if(!e.length){W.error("请输入规格值");return}$.value=!1;for(let c=0;c<e.length;c++){const v=e[c];if(!(Object.prototype.toString.call(v)==="[object Object]")){m=m+1;break}}const r=[];for(let c=0;c<e.length;c++){const v=e[c];Object.prototype.toString.call(v)==="[object Object]"?r.push(v):(u=u+1,r.push({propId:m,propValue:v,valueId:u}))}U.addSkuTag({tagName:b.value.propName,tagItems:r}),S.value=1,H()},H=()=>{b.value={propName:"",selectValues:[]},E.value=[]},ae=()=>{var r;E.value=[],b.value.selectValues=[];const e=(r=F.value)==null?void 0:r.findIndex(c=>c.propName===b.value.propName);e!==-1&&_({url:_.adornUrl(`/prod/spec/listSpecValue/${F.value[e].propId}`),method:"get",params:_.adornParams()}).then(({data:c})=>{E.value=c})},se=(e,r)=>{y=t.value[e].tagName,f=e,R.value=t.value[e].tagItems[r].propValue,t.value[e].tagItems.length!==1&&(S.value=4,U.removeSkuTagItem(e,r))},X=e=>{if(ue(e))return;const r=t.value[e].tagItems,c=g.value[e].value,v=r.length-1;y=t.value[e].tagName,R.value=g.value[e].value;const T=re(t.value[e].tagItems),h={propId:v===-1?0:t.value[e].tagItems[v].propId,propValue:c,valueId:v===-1?0:T+1};h&&U.addSkuTagItem({tagIndex:e,tagItem:h}),g.value[e].visible=!1,g.value[e].value="",S.value=2},te=e=>{g.value.push({visible:!1,value:""}),g.value[e].visible=!0,ke(()=>{[`saveTagInput${e}`][0].value.input.focus()})},re=e=>Math.max.apply(Math,e.map(r=>r.valueId)),ne=e=>{S.value=3,U.removeSkuTag(e)},ue=e=>{var v;const r=g.value[e].value;if(!r)return g.value[e].visible=!1,g.value[e].value="",!0;let c=!1;return(v=t.value)==null||v.forEach(T=>{if(T.tagItems.map(k=>k.propValue).indexOf(r)>-1)return c=!0,W.error("product.specificationValue"),!1}),c};return(e,r)=>{const c=de,v=_e,T=me,h=le,k=pe,M=ie,J=he;return d(),I("div",st,[l(h,{label:"商品规格"},{default:a(()=>[l(c,{onClick:r[0]||(r[0]=P=>p())},{default:a(()=>[j(" 添加规格 ")]),_:1}),(d(!0),I(K,null,z(s(t),(P,A)=>(d(),I("div",{key:A},[ce("span",null,q(P.tagName),1),l(c,{class:"button-new-tag",type:"text",icon:"el-icon-delete",onClick:G=>ne(A)},{default:a(()=>[j(" 删除 ")]),_:2},1032,["onClick"]),rt,(d(!0),I(K,null,z(P.tagItems,(G,we)=>(d(),x(v,{key:G.valueId,closable:"","disable-transitions":!1,onClose:ct=>se(A,we)},{default:a(()=>[j(q(G.propValue),1)]),_:2},1032,["onClose"]))),128)),s(g)[A]&&s(g)[A].visible?(d(),x(T,{key:0,ref_for:!0,ref:`saveTagInput${A}`,modelValue:s(g)[A].value,"onUpdate:modelValue":G=>s(g)[A].value=G,class:"input-new-tag",onKeyup:Ae(G=>X(A),["enter"]),onBlur:G=>X(A)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(d(),x(c,{key:1,class:"button-new-tag",onClick:G=>te(A)},{default:a(()=>[j(" + 添加 ")]),_:2},1032,["onClick"]))]))),128))]),_:1}),Z(l(h,{label:"规格名"},{default:a(()=>[l(J,{span:8},{default:a(()=>[l(M,{modelValue:s(b).propName,"onUpdate:modelValue":r[1]||(r[1]=P=>s(b).propName=P),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择",onChange:ae},{default:a(()=>[(d(!0),I(K,null,z(s(n),P=>(d(),x(k,{key:P.propId,label:P.propName,value:P.propName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512),[[ee,s($)]]),Z(l(h,{label:"规格值"},{default:a(()=>[l(J,{span:8},{default:a(()=>[l(M,{modelValue:s(b).selectValues,"onUpdate:modelValue":r[2]||(r[2]=P=>s(b).selectValues=P),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择"},{default:a(()=>[(d(!0),I(K,null,z(s(E),P=>(d(),x(k,{key:P.valueId,label:P.propValue,value:P.propValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512),[[ee,s($)]]),l(h,null,{default:a(()=>[Z(l(c,{type:"primary",onClick:r[3]||(r[3]=P=>Q())},{default:a(()=>[j(" 确定 ")]),_:1},512),[[ee,s($)]]),Z(l(c,{onClick:r[4]||(r[4]=P=>N())},{default:a(()=>[j(" 取消 ")]),_:1},512),[[ee,s($)]])]),_:1})])}}},ut=be(nt,[["__scopeId","data-v-e44b7051"]]);const pt={class:"mod-prod-sku-table"},it={__name:"sku-table",props:{modelValue:{default:()=>[],type:Array},prodName:{default:"",type:String}},emits:["update:modelValue"],setup(w,{expose:O,emit:C}){const o=w,U=L([]);let $=!1;const b=Y(()=>{const y=[];for(let f=0;f<R.value.length;f++){const u=R.value[f];y.push(u.tagName)}return y}),S=ye(),R=Y({get(){return S.skuTags}});fe(()=>o.prodName,()=>{F()}),oe(()=>{_({url:_.adornUrl("/prod/spec/list"),method:"get",params:_.adornParams()}).then(({data:y})=>{U.value=y})}),O({init:()=>{$=!0}});const E=y=>{o.modelValue[y].status=o.modelValue[y].status?0:1},F=()=>{if($)return;const y=[];for(let f=0;f<o.modelValue.length;f++){const u=Object.assign({},o.modelValue[f]);if(!u.properties)return;u.skuName="";const m=u.properties.split(";");for(const V in m)u.skuName+=m[V].split(":")[1]+" ";u.prodName=o.prodName+" "+u.skuName,y.push(u)}C("update:modelValue",y)};return(y,f)=>{const u=ge,m=qe,V=me,t=Se,n=de,i=ve,D=le;return d(),I("div",pt,[l(D,null,{default:a(()=>[l(i,{data:w.modelValue,border:"",style:{width:"100%","margin-top":"20px"}},{default:a(()=>[(d(!0),I(K,null,z(s(b),(p,N)=>(d(),x(u,{key:N,label:p},{default:a(Q=>[j(q(Q.row.properties.split(";")[N].split(":")[1]),1)]),_:2},1032,["label"]))),128)),s(b).length?(d(),x(u,{key:0,prop:"pic",label:"sku图片",width:"180"},{default:a(p=>[l(m,{modelValue:p.row.pic,"onUpdate:modelValue":N=>p.row.pic=N},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):B("",!0),s(b).length?(d(),x(u,{key:1,prop:"prodName",label:"商品名称",width:"250"},{default:a(p=>[l(V,{modelValue:p.row.prodName,"onUpdate:modelValue":N=>p.row.prodName=N,type:"textarea",disabled:!p.row.status},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})):B("",!0),l(u,{prop:"price",label:"销售价",width:"160"},{default:a(p=>[l(t,{modelValue:p.row.price,"onUpdate:modelValue":N=>p.row.price=N,"controls-position":"right",precision:2,max:1e9,min:.01,disabled:!p.row.status},null,8,["modelValue","onUpdate:modelValue","min","disabled"])]),_:1}),l(u,{prop:"oriPrice",label:"市场价",width:"160"},{default:a(p=>[l(t,{modelValue:p.row.oriPrice,"onUpdate:modelValue":N=>p.row.oriPrice=N,"controls-position":"right",precision:2,max:1e9,min:.01,disabled:!p.row.status},null,8,["modelValue","onUpdate:modelValue","min","disabled"])]),_:1}),l(u,{prop:"stocks",label:"库存",width:"160"},{default:a(p=>[l(t,{modelValue:p.row.stocks,"onUpdate:modelValue":N=>p.row.stocks=N,min:0,"controls-position":"right",type:"number",disabled:!p.row.status},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),l(u,{prop:"weight",label:"商品重量(kg)",width:"210"},{default:a(p=>[l(t,{modelValue:p.row.weight,"onUpdate:modelValue":N=>p.row.weight=N,precision:2,min:0,"controls-position":"right",disabled:!p.row.status},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),l(u,{prop:"volume",label:"商品体积(m³)",width:"210"},{default:a(p=>[l(t,{modelValue:p.row.volume,"onUpdate:modelValue":N=>p.row.volume=N,precision:2,min:0,"controls-position":"right",disabled:!p.row.status},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),l(u,{label:"操作"},{default:a(p=>[p.row.status?(d(),x(n,{key:0,type:"text",onClick:N=>E(`${p.$index}`)},{default:a(()=>[j(" 禁用 ")]),_:2},1032,["onClick"])):(d(),x(n,{key:1,type:"text",onClick:N=>E(`${p.$index}`)},{default:a(()=>[j(" 启用 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})])}}},dt=be(it,[["__scopeId","data-v-738e73fd"]]),mt={class:"mod-prod-info"},il={__name:"index",emits:["refreshDataList"],setup(w,{emit:O}){const C=Oe({list:[],selected:[],props:{value:"categoryId",label:"categoryName"}}),o=L({prodName:"",brief:"",pic:"",imgs:"",categoryId:0,prodId:0,skuList:[],tagList:[],content:"",status:1,deliveryMode:{hasShopDelivery:!1,hasUserPickUp:!1},deliveryTemplateId:null}),U=L([]);oe(()=>{o.value.prodId=ze().query.prodId,S()});const $=L(null),b=L(null),S=()=>{V(),R().then(()=>{o.value.prodId?_({url:_.adornUrl(`/prod/prod/info/${o.value.prodId}`),method:"get",params:_.adornParams()}).then(({data:t})=>{var n,i;o.value=t,o.value.deliveryMode=JSON.parse(t.deliveryMode),(n=b.value)==null||n.init(t.skuList),(i=$.value)==null||i.init(),C.selected=je(C.list,o.value.categoryId,"categoryId","children").reverse(),o.value.tagList=t.tagList}):ke(()=>{var t,n;(t=F.value)==null||t.resetFields(),(n=b.value)==null||n.init(),o.value.pic="",o.value.imgs=""})})},R=()=>_({url:_.adornUrl("/prod/category/listCategory"),method:"get",params:_.adornParams()}).then(({data:t})=>{C.list=xe(t,"categoryId","parentId")}),g=t=>{o.value.categoryId=t[t.length-1]},E=Ge(),F=L(null),y=Ke(()=>{var t;(t=F.value)==null||t.validate(n=>{if(!n)return;if(!o.value.imgs){m("请选择图片上传");return}if(!o.value.deliveryMode){m("请选择配送方式");return}if(o.value.deliveryMode.hasShopDelivery&&!o.value.deliveryTemplateId){m("请选择运费模板");return}const i=Object.assign({},o.value);f(i),i.deliveryMode=void 0,i.deliveryModeVo=o.value.deliveryMode,i.pic=o.value.imgs.split(",")[0],_({url:_.adornUrl("/prod/prod"),method:i.prodId?"put":"post",data:_.adornData(i)}).then(()=>{W({message:"操作成功",type:"success",duration:1500,onClose:()=>{E.push({path:"/prod/prodList"}),O("refreshDataList")}})})})}),f=t=>{t.totalStocks=0,t.price=0,t.oriPrice=0;for(let n=0;n<t.skuList.length;n++){const i=t.skuList[n];i.status===1&&(t.price===0&&(t.price=i.price?Number.parseFloat(i.price):0),t.price=Math.min(t.price,i.price),t.price===i.price&&(t.oriPrice=i.oriPrice?Number.parseFloat(i.oriPrice):0),t.totalStocks+=i.stocks?Number.parseInt(i.stocks):0)}t.skuList.length===1&&(t.skuList[0].prodName=o.value.prodName)},u=t=>{const n=o.value.prodName;t.forEach(i=>{if(i.properties){i.skuName="";const D=i.properties.split(";");for(const p in D)i.skuName+=D[p].split(":")[1]+" ";i.prodName=n+" "+i.skuName}}),o.value.skuList=t},m=t=>{W({message:t,type:"error",duration:1500})},V=()=>{_({url:_.adornUrl("/prod/prodTag/listTagList"),method:"get",params:_.adornParams()}).then(({data:t})=>{U.value=t})};return(t,n)=>{const i=Je,D=le,p=$e,N=Ce,Q=Le,H=he,ae=pe,se=ie,X=me,te=Pe,re=Ee,ne=de,ue=Ue;return d(),I("div",mt,[l(ue,{ref_key:"dataFormRef",ref:F,model:s(o),"label-width":"100px"},{default:a(()=>[l(D,{label:"产品图片"},{default:a(()=>[l(i,{modelValue:s(o).imgs,"onUpdate:modelValue":n[0]||(n[0]=e=>s(o).imgs=e)},null,8,["modelValue"])]),_:1}),l(D,{label:"状态"},{default:a(()=>[l(N,{modelValue:s(o).status,"onUpdate:modelValue":n[1]||(n[1]=e=>s(o).status=e)},{default:a(()=>[l(p,{label:1},{default:a(()=>[j(" 上架 ")]),_:1}),l(p,{label:0},{default:a(()=>[j(" 下架 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(D,{label:"产品分类",rules:[{required:!0,message:"请选择产品分类"}],prop:"categoryId"},{default:a(()=>[l(H,{span:8},{default:a(()=>[l(Q,{modelValue:s(C).selected,"onUpdate:modelValue":n[2]||(n[2]=e=>s(C).selected=e),"expand-trigger":"hover",options:s(C).list,props:s(C).props,"change-on-select":"",onChange:g},null,8,["modelValue","options","props"])]),_:1})]),_:1}),l(D,{label:"产品分组",rules:[{required:!0,message:"请选择产品分组"}]},{default:a(()=>[l(H,{span:8},{default:a(()=>[l(se,{modelValue:s(o).tagList,"onUpdate:modelValue":n[3]||(n[3]=e=>s(o).tagList=e),multiple:"",style:{width:"250px"},placeholder:"请选择"},{default:a(()=>[(d(!0),I(K,null,z(s(U),e=>(d(),x(ae,{key:e.id,label:e.title,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(D,{label:"产品名称",prop:"prodName",rules:[{required:!0,message:"产品名称不能为空"},{pattern:/\s\S+|S+\s|\S/,message:"请输入正确的产品名称",trigger:"blur"}]},{default:a(()=>[l(H,{span:8},{default:a(()=>[l(X,{modelValue:s(o).prodName,"onUpdate:modelValue":n[4]||(n[4]=e=>s(o).prodName=e),placeholder:"产品名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1}),l(D,{label:"产品卖点",prop:"brief",rules:[{required:!1,pattern:/\s\S+|S+\s|\S/,message:"请输入正确的产品卖点",trigger:"blur"}]},{default:a(()=>[l(H,{span:8},{default:a(()=>[l(X,{modelValue:s(o).brief,"onUpdate:modelValue":n[5]||(n[5]=e=>s(o).brief=e),type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"产品卖点"},null,8,["modelValue"])]),_:1})]),_:1}),l(D,{label:"配送方式"},{default:a(()=>[l(te,{modelValue:s(o).deliveryMode.hasShopDelivery,"onUpdate:modelValue":n[6]||(n[6]=e=>s(o).deliveryMode.hasShopDelivery=e)},{default:a(()=>[j(" 商家配送 ")]),_:1},8,["modelValue"]),l(te,{modelValue:s(o).deliveryMode.hasUserPickUp,"onUpdate:modelValue":n[7]||(n[7]=e=>s(o).deliveryMode.hasUserPickUp=e)},{default:a(()=>[j(" 用户自提 ")]),_:1},8,["modelValue"])]),_:1}),Z(l(ot,{modelValue:s(o).deliveryTemplateId,"onUpdate:modelValue":n[8]||(n[8]=e=>s(o).deliveryTemplateId=e)},null,8,["modelValue"]),[[ee,s(o).deliveryMode.hasShopDelivery]]),l(ut,{ref_key:"skuTagRef",ref:b,"sku-list":s(o).skuList,onChange:u},null,8,["sku-list"]),l(dt,{ref_key:"skuTableRef",ref:$,modelValue:s(o).skuList,"onUpdate:modelValue":n[9]||(n[9]=e=>s(o).skuList=e),"prod-name":s(o).prodName},null,8,["modelValue","prod-name"]),l(D,{label:"产品详情",prop:"content"},{default:a(()=>[l(re,{ref:"contentRef",modelValue:s(o).content,"onUpdate:modelValue":n[10]||(n[10]=e=>s(o).content=e),style:{width:"1000px"}},null,8,["modelValue"])]),_:1}),l(D,null,{default:a(()=>[l(ne,{type:"primary",onClick:n[11]||(n[11]=e=>s(y)())},{default:a(()=>[j(" 确定 ")]),_:1})]),_:1})]),_:1},8,["model"])])}}};export{il as default};
