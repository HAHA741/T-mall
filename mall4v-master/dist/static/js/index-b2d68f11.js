import{a as U,c as E,b as O,P as F,d as P,e as D,f as z,g as M}from"./element-plus@2.3.6_vue@3.2.47-2ccbbec5.js";import{b as A,w as I}from"./@vue_runtime-dom@3.2.47-65c92196.js";import{h as s,t as j,a as S}from"./index-ac6793f4.js";import{D as q}from"./debounce-d39f6322.js";import{r as f,j as N,u as t,i as H}from"./@vue_reactivity@3.2.47-b35eb3c0.js";import{o as _,K as k,L as i,a as W,e as p,P as h,n as $,c as Y,O as b,Y as G}from"./@vue_runtime-core@3.2.47-7772318f.js";import"./lodash-es@4.17.21-53d52778.js";import"./@vue-eb92069c.js";import"./@ctrl_tinycolor@3.6.1-93e5f6fc.js";import"./@vueuse_core@9.13.0_vue@3.2.47-f8689e2f.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-4c633672.js";import"./@vue_shared@3.2.47-804b7488.js";import"./@element-plus_icons-vue@2.1.0_vue@3.2.47-c959b2bd.js";import"./@sxzz_popperjs-es@2.11.7-eb0a044a.js";import"./dayjs@1.11.13-e8f4b8a8.js";import"./async-validator@4.2.5-940bb5fd.js";import"./memoize-one@6.0.0-43ba193c.js";import"./escape-html@1.0.3-d65727e0.js";import"./normalize-wheel-es@1.2.0-fb80f16a.js";import"./@floating-ui_dom@1.6.12-11ac7818.js";import"./@floating-ui_core@1.6.8-010b5758.js";import"./@floating-ui_utils@0.2.8-6db9c233.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-d8bd5cdb.js";import"./vue@3.2.47-3eac09d8.js";import"./pinia@2.0.33_vue@3.2.47-da3f2561.js";import"./vue-demi@0.14.10_vue@3.2.47-71ba0ef2.js";import"./moment@2.29.4-4717c495.js";import"./vue-router@4.1.6_vue@3.2.47-3725844c.js";import"./vue-cookies@1.8.3-b35a0960.js";import"./axios@1.3.4-4a7005d9.js";import"./qs@6.11.1-8e85f023.js";import"./side-channel@1.0.6-025da103.js";import"./get-intrinsic@1.2.4-25c259ca.js";import"./es-errors@1.3.0-82fd953f.js";import"./has-symbols@1.0.3-8f82dcae.js";import"./has-proto@1.0.3-1353c55e.js";import"./function-bind@1.1.2-61637ca6.js";import"./hasown@2.0.2-42bc0a75.js";import"./call-bind@1.0.7-82cb89a2.js";import"./set-function-length@1.2.2-7418ecdf.js";import"./define-data-property@1.1.4-53ade537.js";import"./es-define-property@1.0.0-8178d4b8.js";import"./gopd@1.0.1-6433dd40.js";import"./has-property-descriptors@1.0.2-f195ed7c.js";import"./object-inspect@1.13.3-0d0634c3.js";import"./crypto-js@4.1.1-0f0eb29b.js";import"./lodash@4.17.21-08c1e7a6.js";import"./@smallwei_avue@3.5.6_element-plus@2.3.6_vue@3.2.47-c4df20a4.js";const J={searchMenuSpan:6,columnBtn:!1,border:!0,selection:!0,index:!1,indexLabel:"序号",stripe:!0,menuAlign:"center",menuWidth:350,align:"center",refreshBtn:!0,searchSize:"mini",addBtn:!1,editBtn:!1,delBtn:!1,viewBtn:!1,props:{label:"label",value:"value"},column:[{label:"角色名称",prop:"roleName",search:!0},{label:"备注",prop:"remark"},{label:"创建时间",prop:"createTime"}]},Q={class:"dialog-footer"},X={__name:"add-or-update",emits:["refreshDataList"],setup(w,{expose:C,emit:v}){const m=f(!1),L=f([]),B={label:"name",children:"children"},o=N({id:0,roleName:"",remark:""}),x=N({roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"},{pattern:/\s\S+|S+\s|\S/,message:"请输入正确的角色名称",trigger:"blur"}],remark:[{required:!1,pattern:/\s\S+|S+\s|\S/,message:"输入格式有误",trigger:"blur"}]}),y=f(null),u=f(null);C({init:n=>{o.id=n||0,s({url:s.adornUrl("/sys/menu/table"),method:"get",params:s.adornParams()}).then(({data:e})=>{L.value=j(e,"menuId","parentId")}).then(()=>{m.value=!0,$(()=>{var e,r;(e=y.value)==null||e.resetFields(),(r=u.value)==null||r.setCheckedKeys([])})}).then(()=>{o.id&&s({url:s.adornUrl(`/sys/role/info/${o.id}`),method:"get",params:s.adornParams()}).then(({data:e})=>{var d;o.roleName=e.roleName,o.remark=e.remark;const r=e.menuIdList.indexOf(-666666);r!==-1&&e.menuIdList.splice(r,e.menuIdList.length-r),(d=u.value)==null||d.setCheckedKeys(e.menuIdList)})})}});const l=q(()=>{var n;(n=y.value)==null||n.validate(e=>{var r,d;e&&s({url:s.adornUrl("/sys/role"),method:o.id?"put":"post",data:s.adornData({roleId:o.id||void 0,roleName:o.roleName,remark:o.remark,menuIdList:[].concat((r=u.value)==null?void 0:r.getCheckedKeys(),[-666666],(d=u.value)==null?void 0:d.getHalfCheckedKeys())})}).then(()=>{U({message:"操作成功",type:"success",duration:1500,onClose:()=>{m.value=!1,v("refreshDataList")}})})})});return(n,e)=>{const r=E,d=O,K=F,R=P,V=D,T=z;return _(),k(T,{modelValue:t(m),"onUpdate:modelValue":e[5]||(e[5]=c=>H(m)?m.value=c:null),title:t(o).id?"修改":"新增","close-on-click-modal":!1},{footer:i(()=>[W("span",Q,[p(V,{onClick:e[3]||(e[3]=c=>m.value=!1)},{default:i(()=>[h("取消")]),_:1}),p(V,{type:"primary",onClick:e[4]||(e[4]=c=>t(l)())},{default:i(()=>[h("确定")]),_:1})])]),default:i(()=>[p(R,{ref_key:"dataFormRef",ref:y,model:t(o),rules:t(x),"label-width":"80px",onKeyup:e[2]||(e[2]=A(c=>t(l)(),["enter"]))},{default:i(()=>[p(d,{label:"角色名称",prop:"roleName"},{default:i(()=>[p(r,{modelValue:t(o).roleName,"onUpdate:modelValue":e[0]||(e[0]=c=>t(o).roleName=c),placeholder:"角色名称"},null,8,["modelValue"])]),_:1}),p(d,{label:"备注",prop:"remark"},{default:i(()=>[p(r,{modelValue:t(o).remark,"onUpdate:modelValue":e[1]||(e[1]=c=>t(o).remark=c),placeholder:"备注"},null,8,["modelValue"])]),_:1}),p(d,{label:"授权"},{default:i(()=>[p(K,{ref_key:"menuListTreeRef",ref:u,data:t(L),props:B,"node-key":"menuId","show-checkbox":""},null,8,["data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},Z={class:"mod-role"},Ye={__name:"index",setup(w){const C=f([]),v=f([]),g=N({total:0,currentPage:1,pageSize:10}),m=(a,l,n)=>{s({url:s.adornUrl("/sys/role/page"),method:"get",params:s.adornParams(Object.assign({current:a==null?g.currentPage:a.currentPage,size:a==null?g.pageSize:a.pageSize},l))}).then(({data:e})=>{C.value=e.records,g.total=e.total,n&&n()})},L=(a,l)=>{m(g,a,l)},B=a=>{v.value=a},o=f(!1),x=f(null),y=a=>{o.value=!0,$(()=>{var l;(l=x.value)==null||l.init(a)})},u=a=>{var n;const l=a?[a]:(n=v.value)==null?void 0:n.map(e=>e.roleId);M.confirm(`确定进行[${a?"删除":"批量删除"}]操作?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s({url:s.adornUrl("/sys/role"),method:"delete",data:s.adornData(l,!1)}).then(()=>{U({message:"操作成功",type:"success",duration:1500,onClose:()=>{m()}})})}).catch(()=>{})};return(a,l)=>{const n=D,e=G("avue-crud");return _(),Y("div",Z,[p(e,{ref:"crudRef",page:t(g),data:t(C),option:t(J),onSearchChange:L,onSelectionChange:B,onOnLoad:m},{"menu-left":i(()=>[t(S)("sys:role:save")?(_(),k(n,{key:0,type:"primary",icon:"el-icon-plus",onClick:l[0]||(l[0]=I(r=>y(),["stop"]))},{default:i(()=>[h(" 新增 ")]),_:1})):b("",!0),t(S)("sys:role:delete")?(_(),k(n,{key:1,type:"danger",disabled:t(v).length<=0,onClick:l[1]||(l[1]=r=>u())},{default:i(()=>[h(" 批量删除 ")]),_:1},8,["disabled"])):b("",!0)]),menu:i(r=>[t(S)("sys:role:update")?(_(),k(n,{key:0,type:"primary",icon:"el-icon-edit",onClick:I(d=>y(r.row.roleId),["stop"])},{default:i(()=>[h(" 编辑 ")]),_:2},1032,["onClick"])):b("",!0),t(S)("sys:role:delete")?(_(),k(n,{key:1,type:"danger",icon:"el-icon-delete",onClick:I(d=>u(r.row.roleId),["stop"])},{default:i(()=>[h(" 删除 ")]),_:2},1032,["onClick"])):b("",!0)]),_:1},8,["page","data","option"]),t(o)?(_(),k(X,{key:0,ref_key:"addOrUpdateRef",ref:x,onRefreshDataList:m},null,512)):b("",!0)])}}};export{Ye as default};
