import{e as B,x as N}from"./element-plus@2.3.6_vue@3.2.47-2ccbbec5.js";import{$ as U}from"./vue-cookies@1.8.3-b35a0960.js";import{h as q}from"./index-ac6793f4.js";import{r as g,u as b}from"./@vue_reactivity@3.2.47-b35eb3c0.js";import{x as w,t as A,n as L,f as $,ag as F,V as T,h as I,o as M,c as D,a as h,e as v,L as k,P as K}from"./@vue_runtime-core@3.2.47-7772318f.js";import{q as O}from"./@vue_shared@3.2.47-804b7488.js";const P=["paste preview anchor autolink  codesample emoticons image link lists media searchreplace table visualblocks wordcount  pagebreak insertdatetime fullscreen code"],G=["searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample hr numlist link image  preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen"];let l=[];function H(){return window.tinymce}const J=(o,c)=>{const n=document.getElementById(o),a=c||function(){};if(!n){const t=document.createElement("script");t.src=o,t.id=o,document.body.appendChild(t),l.push(a),("onload"in t?d:u)(t)}n&&a&&(H()?a(null,n):l.push(a));function d(t){t.onload=function(){this.onerror=this.onload=null;for(const i of l)i(null,t);l=null},t.onerror=function(){document.body.removeChild(t),this.onerror=this.onload=null,a(new Error("Failed to load "+o),t)}}function u(t){t.onreadystatechange=function(){if(!(this.readyState!=="complete"&&this.readyState!=="loaded")){this.onreadystatechange=null;for(const i of l)i(null,t);l=null}}}};const R={class:"components-tiny-mce"},Q=["id"],W={class:"add-or-upload"},oe={__name:"index",props:{modelValue:{type:String,default:""},toolbar:{type:Array,required:!1,default(){return[]}},menubar:{type:String,default:"file edit insert view format table"},id:{type:String,default:function(){return"vue-tinymce-"+ +new Date+((Math.random()*1e3).toFixed(0)+"")}},height:{type:[Number,String],required:!1,default:360},width:{type:[Number,String],required:!1,default:"auto"}},emits:["update:modelValue"],setup(o,{emit:c}){const n=o,a={Authorization:U.get("Authorization")},d=q.adornUrl("/admin/file/upload/element"),u=g(!1);let t=!1,i=!1;w(()=>n.modelValue,e=>{!i&&t&&S(e)});const _=A(()=>localStorage.getItem("b2cLang")||"zh_CN");w(()=>_.value,()=>{f(),L(()=>p())}),$(()=>{C()}),F(()=>{window.tinymce&&p()}),T(()=>{f()}),I(()=>{f()});const x=new URL("/static/js/tinymce/js/tinymce/tinymce.min.js",self.location).href,C=()=>{J(x,e=>{e||p()})},m=g(n.id),y=g(!1),p=()=>{window.tinymce.init({language:_.value,selector:`#${m.value}`,height:n.height,body_class:"panel-body ",object_resizing:!1,toolbar:n.toolbar.length>0?n.toolbar:G,menubar:n.menubar,plugins:P,end_container_on_empty_block:!0,powerpaste_word_import:"clean",paste_enable_default_filters:!1,code_dialog_height:450,code_dialog_width:1e3,content_style:"body {-webkit-user-modify: read-write;overflow-wrap: break-word;-webkit-line-break: after-white-space;}img {max-width: 100%;vertical-align:initial}",advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,init_instance_callback:e=>{n.modelValue&&e.setContent(n.modelValue),t=!0,e.on("NodeChange Change KeyUp SetContent",()=>{i=!0,c("update:modelValue",e.getContent())})},setup:e=>{e.on("FullscreenStateChanged",s=>{y.value=s.state})},convert_urls:!1})},f=()=>{try{const e=window.tinymce.get(m.value);y.value&&e.execCommand("mceFullScreen"),e&&e.destroy()}catch(e){}},S=e=>{window.tinymce&&window.tinymce.get(m.value).setContent(e||"")},E="https://img.mall4j.com/",V=(e,s,r)=>{window.tinymce.get(n.id).insertContent(`<img alt="" src="${E+s.response.data}" >`)},j=e=>{const s=e.type==="image/jpeg"||e.type==="image/png"||e.type==="image/gif"||e.type==="image/jpg";s||this.$message.error("上传图片只能是jpeg/jpg/png/gif 格式!");const r=e.size/1024/1024<2;return r||this.$message.error("上传图片大小不能超过 2MB!"),r&&s};return(e,s)=>{const r=B,z=N;return M(),D("div",R,[h("div",{class:O(["tinymce-container",{"tox-fullscreen":b(u)}])},[h("textarea",{id:o.id,class:"tinymce-textarea"},null,8,Q),h("div",W,[v(z,{class:"upload-demo","list-type":"picture",action:b(d),headers:a,"on-success":V,"show-file-list":!1,"before-upload":j},{default:k(()=>[v(r,{size:"small",type:"primary"},{default:k(()=>[K(" 点击上传图片 ")]),_:1})]),_:1},8,["action"])])],2)])}}};export{oe as _};
