import{a as S,c as le,b as ne,G as oe,H as se,A as J,e as Y,B as ie,C as de,J as ue,d as pe,f as fe,g as me}from"./element-plus@2.3.6_vue@3.2.47-2ccbbec5.js";import{b as ce,w as E}from"./@vue_runtime-dom@3.2.47-65c92196.js";import{_ as _e,a as U,h as v}from"./index-ac6793f4.js";import{D as ye}from"./debounce-d39f6322.js";import{r as b,j as ge,u as l,i as he}from"./@vue_reactivity@3.2.47-b35eb3c0.js";import{t as ve,x as be,o as i,K as f,L as a,a as Fe,e as o,P as s,c as F,O as p,F as R,W as q,n as z,Y as Ce}from"./@vue_runtime-core@3.2.47-7772318f.js";import{O as A}from"./@vue_shared@3.2.47-804b7488.js";import"./lodash-es@4.17.21-53d52778.js";import"./@vue-eb92069c.js";import"./@ctrl_tinycolor@3.6.1-93e5f6fc.js";import"./@vueuse_core@9.13.0_vue@3.2.47-f8689e2f.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-4c633672.js";import"./@element-plus_icons-vue@2.1.0_vue@3.2.47-c959b2bd.js";import"./@sxzz_popperjs-es@2.11.7-eb0a044a.js";import"./dayjs@1.11.13-e8f4b8a8.js";import"./async-validator@4.2.5-940bb5fd.js";import"./memoize-one@6.0.0-43ba193c.js";import"./escape-html@1.0.3-d65727e0.js";import"./normalize-wheel-es@1.2.0-fb80f16a.js";import"./@floating-ui_dom@1.6.12-11ac7818.js";import"./@floating-ui_core@1.6.8-010b5758.js";import"./@floating-ui_utils@0.2.8-6db9c233.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-d8bd5cdb.js";import"./vue@3.2.47-3eac09d8.js";import"./pinia@2.0.33_vue@3.2.47-da3f2561.js";import"./vue-demi@0.14.10_vue@3.2.47-71ba0ef2.js";import"./moment@2.29.4-4717c495.js";import"./vue-router@4.1.6_vue@3.2.47-3725844c.js";import"./vue-cookies@1.8.3-b35a0960.js";import"./axios@1.3.4-4a7005d9.js";import"./qs@6.11.1-8e85f023.js";import"./side-channel@1.0.6-025da103.js";import"./get-intrinsic@1.2.4-25c259ca.js";import"./es-errors@1.3.0-82fd953f.js";import"./has-symbols@1.0.3-8f82dcae.js";import"./has-proto@1.0.3-1353c55e.js";import"./function-bind@1.1.2-61637ca6.js";import"./hasown@2.0.2-42bc0a75.js";import"./call-bind@1.0.7-82cb89a2.js";import"./set-function-length@1.2.2-7418ecdf.js";import"./define-data-property@1.1.4-53ade537.js";import"./es-define-property@1.0.0-8178d4b8.js";import"./gopd@1.0.1-6433dd40.js";import"./has-property-descriptors@1.0.2-f195ed7c.js";import"./object-inspect@1.13.3-0d0634c3.js";import"./crypto-js@4.1.1-0f0eb29b.js";import"./lodash@4.17.21-08c1e7a6.js";import"./@smallwei_avue@3.5.6_element-plus@2.3.6_vue@3.2.47-c4df20a4.js";const ke={searchMenuSpan:6,columnBtn:!1,border:!0,index:!1,selection:!0,indexLabel:"序号",stripe:!0,menuAlign:"center",menuWidth:350,align:"center",refreshBtn:!0,searchSize:"mini",addBtn:!1,editBtn:!1,delBtn:!1,viewBtn:!1,props:{label:"label",value:"value"},column:[{label:"模板名称",prop:"transName",search:!0}]};const xe={key:0},$e={key:1},Ve={key:2},we={key:0,style:{"margin-top":"20px"}},Ue={key:0},Le={key:3,style:{"margin-top":"20px"}},Te={class:"dialog-footer"},Pe={__name:"add-or-update",emits:["refreshDataList"],setup(X,{expose:N,emit:P}){const C=b(0),_=b(!1),t=b({hasFreeCondition:!1,transName:"",createTime:"",chargeType:0,transportId:0,isFreeFee:0,transfees:[{cityList:[],status:1}],transfeeFrees:[{freeCityList:[],freeType:0}]}),O=ge({total:0,currentPage:1,pageSize:10}),h=ve(()=>{const n=[["首件(个)","运费(元)","续件(个)","续费(元)"],["首重(kg)","运费(元)","续重(kg)","续费(元)"],["首体积(m³)","运费(元)","续体积(m³)","续费(元)"]];return t.value.chargeType?n[t.value.chargeType]:n[0]});be(()=>_.value,n=>{n||(L.value=!1)});const L=b(!1),I=b(null);N({init:n=>{_.value=!0,t.value.transportId=n||0,z(()=>{var r;(r=I.value)==null||r.resetFields(),t.value={hasFreeCondition:!1,transName:"",createTime:"",chargeType:0,transportId:0,isFreeFee:0,transfees:[{cityList:[],status:1}],transfeeFrees:[{freeCityList:[],freeType:0}]}}),t.value.transportId&&v({url:v.adornUrl(`/shop/transport/info/${t.value.transportId}`),method:"get"}).then(({data:r})=>{r.isFreeFee?r.transfees[0].status=0:r.transfees[0].status=1,t.value=r,t.value.hasFreeCondition=!!r.hasFreeCondition})}});const m=(n,r,u)=>{u===0&&(t.value.transfees[n].cityList=r),u===1&&(t.value.transfeeFrees[n].freeCityList=r)},c=()=>{t.value.transfees.push({cityList:[],status:1})},k=n=>{t.value.transfees.splice(n,1)},y=b(null),B=()=>{S({message:"该功能未开源",type:"warning",duration:1500})},x=()=>{var n;t.value.hasFreeCondition&&((n=t.value.transfeeFrees)==null||n.push({freeCityList:[],freeType:0}))},T=n=>{var r;(r=t.value.transfeeFrees)==null||r.splice(n,1)},Z=n=>{L.value=!0;let r=[];for(let u=1;u<t.value.transfeeFrees.length;u++){const g=t.value.transfeeFrees[u].freeCityList;r=r.concat(g)}z(()=>{var u;(u=y.value)==null||u.init(n,t.value.transfeeFrees[n].freeCityList||[],r,1)})},ee=n=>{t.value.hasFreeCondition=!1,n?(t.value.chargeType=0,t.value.transfees=[{cityList:[],status:0,firstPiece:1,firstFee:0,continuousPiece:1,continuousFee:0}]):t.value.transfees=[{cityList:[],status:1}]},K=(n,r)=>{r===1?(n.firstPiece=j(n.firstPiece),n.firstPiece=n.firstPiece===0?1:n.firstPiece):r===3&&(n.continuousPiece=j(n.continuousPiece),n.continuousPiece=n.continuousPiece===0?1:n.continuousPiece)},j=n=>(n=Math.round(n),n<0?0:n),G=ye(()=>{var n;(n=I.value)==null||n.validate(r=>{if(r){for(let u=1;u<t.value.transfees.length;u++)if(t.value.transfees[u].cityList.length===0){S({message:"请选择可配送区域",type:"error",duration:1500});return}t.value.hasFreeCondition?C.value=1:C.value=0,t.value.transfees[0].cityList=[],v({url:v.adornUrl("/shop/transport"),method:t.value.transportId?"put":"post",data:v.adornData({transportId:t.value.transportId||void 0,transName:t.value.transName,chargeType:t.value.chargeType,isFreeFee:t.value.isFreeFee,transfees:t.value.transfees,transfeeFrees:t.value.transfeeFrees,hasFreeCondition:C.value})}).then(()=>{S({message:"操作成功",type:"success",duration:1500,onClose:()=>{_.value=!1,P("refreshDataList",O)}})})}})});return(n,r)=>{const u=le,g=ne,$=oe,D=se,W=J,V=Y,w=ie,H=de,te=ue,ae=pe,re=fe;return i(),f(re,{modelValue:l(_),"onUpdate:modelValue":r[9]||(r[9]=e=>he(_)?_.value=e:null),title:l(t).transportId?"修改":"新增","close-on-click-modal":!1,width:"1400px",class:"transport-dialog"},{footer:a(()=>[Fe("div",Te,[o(V,{onClick:r[7]||(r[7]=e=>_.value=!1)},{default:a(()=>[s(" 取消 ")]),_:1}),o(V,{type:"primary",onClick:r[8]||(r[8]=e=>l(G)())},{default:a(()=>[s(" 确定 ")]),_:1})])]),default:a(()=>[o(ae,{ref_key:"dataFormRef",ref:I,model:l(t),"label-width":"80px",onKeyup:r[6]||(r[6]=ce(e=>l(G)(),["enter"]))},{default:a(()=>[o(g,{label:"模板名称",prop:"transName",rules:[{required:!0,message:"模板名称不能为空"},{pattern:/\s\S+|S+\s|\S/,message:"请输入正确的模板名称",trigger:"blur"}]},{default:a(()=>[o(u,{modelValue:l(t).transName,"onUpdate:modelValue":r[0]||(r[0]=e=>l(t).transName=e),placeholder:"模板名称"},null,8,["modelValue"])]),_:1}),o(g,{label:"模板类型",prop:"isFreeFee",required:"required"},{default:a(()=>[o(D,{modelValue:l(t).isFreeFee,"onUpdate:modelValue":r[1]||(r[1]=e=>l(t).isFreeFee=e),onChange:ee},{default:a(()=>[o($,{label:0},{default:a(()=>[s(" 买家承担运费 ")]),_:1}),o($,{label:1},{default:a(()=>[s(" 卖家包邮 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"收费方式",prop:"chargeType"},{default:a(()=>[o(D,{modelValue:l(t).chargeType,"onUpdate:modelValue":r[2]||(r[2]=e=>l(t).chargeType=e),disabled:l(t).isFreeFee==1},{default:a(()=>[o($,{label:0},{default:a(()=>[s(" 按件数 ")]),_:1}),o($,{label:1},{default:a(()=>[s(" 按重量 ")]),_:1}),o($,{label:2},{default:a(()=>[s(" 按体积 ")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),o(H,{data:l(t).transfees,border:"",style:{width:"100%"},class:"table-con"},{default:a(()=>[o(w,{"header-align":"center",align:"center",width:"450",label:"可配送区域"},{default:a(e=>[e.$index==0?(i(),F("span",xe,"所有地区")):p("",!0),(!e.row.cityList||!e.row.cityList.length)&&e.$index>0?(i(),F("span",$e,"请选择可配送区域")):p("",!0),e.$index>0?(i(),F("span",Ve,[(i(!0),F(R,null,q(e.row.cityList,d=>(i(),f(W,{key:d.areaId},{default:a(()=>[s(A(d.areaName),1)]),_:2},1024))),128))])):p("",!0),l(U)("shop:transfee:update")&&e.$index>0?(i(),f(V,{key:3,type:"text",onClick:d=>B(`${e.$index}`)},{default:a(()=>[s(" 编辑 ")]),_:2},1032,["onClick"])):p("",!0),l(U)("shop:transfee:delete")&&e.$index>0?(i(),f(V,{key:4,type:"text",onClick:d=>k(`${e.$index}`)},{default:a(()=>[s(" 删除 ")]),_:2},1032,["onClick"])):p("",!0)]),_:1}),o(w,{"header-align":"center",align:"center",width:"180",label:l(h)[0]},{default:a(e=>[o(g,{prop:`transfees.${e.$index}.firstPiece`,"label-width":"0px",rules:[{required:!0,message:`${l(h)[0]}不能为空`}]},{default:a(()=>[o(u,{modelValue:e.row.firstPiece,"onUpdate:modelValue":d=>e.row.firstPiece=d,type:"number",disabled:!e.row.status&&e.$index===0,onChange:d=>K(e.row,1)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),o(w,{"header-align":"center",align:"center",label:l(h)[1]},{default:a(e=>[o(g,{prop:`transfees.${e.$index}.firstFee`,"label-width":"0px",rules:[{required:!0,message:`${l(h)[1]}不能为空`}]},{default:a(()=>[o(u,{modelValue:e.row.firstFee,"onUpdate:modelValue":d=>e.row.firstFee=d,type:"number",min:0,disabled:!e.row.status&&e.$index===0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),o(w,{"header-align":"center",align:"center",label:l(h)[2]},{default:a(e=>[o(g,{prop:`transfees.${e.$index}.continuousPiece`,"label-width":"0px",rules:[{required:!0,message:`${l(h)[2]}不能为空`}]},{default:a(()=>[o(u,{modelValue:e.row.continuousPiece,"onUpdate:modelValue":d=>e.row.continuousPiece=d,type:"number",disabled:!e.row.status&&e.$index===0,onChange:d=>K(e.row,3)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),o(w,{"header-align":"center",align:"center",label:l(h)[3]},{default:a(e=>[o(g,{prop:`transfees.${e.$index}.continuousFee`,"label-width":"0px",rules:[{required:!0,message:`${l(h)[3]}不能为空`}]},{default:a(()=>[o(u,{modelValue:e.row.continuousFee,"onUpdate:modelValue":d=>e.row.continuousFee=d,type:"number",min:0,disabled:!e.row.status&&e.$index===0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"])]),_:1},8,["data"]),l(t).isFreeFee==0?(i(),F("div",we,[o(V,{type:"primary",icon:"el-icon-location-outline",onClick:r[3]||(r[3]=e=>c())},{default:a(()=>[s(" 点击添加可配送的区域和运费 ")]),_:1})])):p("",!0),l(t).isFreeFee?p("",!0):(i(),f(te,{key:1,modelValue:l(t).hasFreeCondition,"onUpdate:modelValue":r[4]||(r[4]=e=>l(t).hasFreeCondition=e),style:{"margin-top":"10px","font-size":"50px"}},{default:a(()=>[s(" 指定条件包邮 ")]),_:1},8,["modelValue"])),l(t).hasFreeCondition&&!l(t).isFreeFee?(i(),f(H,{key:2,data:l(t).transfeeFrees,border:"",style:{width:"100%"}},{default:a(()=>[o(w,{"header-align":"center",align:"center",width:"350",label:"指定区域"},{default:a(e=>[!e.row.freeCityList||!e.row.freeCityList.length?(i(),F("span",Ue,"请选择指定包邮城市")):p("",!0),(i(!0),F(R,null,q(e.row.freeCityList,d=>(i(),f(W,{key:d.areaId},{default:a(()=>[s(A(d.areaName),1)]),_:2},1024))),128)),l(U)("shop:transfee:update")?(i(),f(V,{key:1,type:"text",onClick:d=>Z(`${e.$index}`)},{default:a(()=>[s(" 编辑 ")]),_:2},1032,["onClick"])):p("",!0),l(U)("shop:transfee:delete")?(i(),f(V,{key:2,type:"text",onClick:d=>T(`${e.$index}`)},{default:a(()=>[s(" 删除 ")]),_:2},1032,["onClick"])):p("",!0)]),_:1}),o(w,{"header-align":"center",align:"center",width:"600",label:"设置包邮条件"},{default:a(e=>[o(D,{modelValue:e.row.freeType,"onUpdate:modelValue":d=>e.row.freeType=d},{default:a(()=>[o($,{label:0},{default:a(()=>[s(" 满件/重量/体积包邮 ")]),_:1}),o($,{label:1},{default:a(()=>[s(" 满金额包邮 ")]),_:1}),o($,{label:2},{default:a(()=>[s(" 满件/重量/体积且满金额包邮 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),o(w,{"header-align":"center",align:"left"},{default:a(e=>[e.row.freeType==1||e.row.freeType==2?(i(),f(g,{key:0,prop:`transfeeFrees.${e.$index}.amount`,"label-width":"0px",rules:[{required:!0,message:"不能为空"}]},{default:a(()=>[s(" 满 "),o(u,{modelValue:e.row.amount,"onUpdate:modelValue":d=>e.row.amount=d,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),s(" 元包邮 ")]),_:2},1032,["prop"])):p("",!0),e.row.freeType==0||e.row.freeType==2?(i(),f(g,{key:1,prop:`transfeeFrees.${e.$index}.piece`,"label-width":"0px",rules:[{required:!0,message:"不能为空"}]},{default:a(()=>[s(" 满 "),o(u,{modelValue:e.row.piece,"onUpdate:modelValue":d=>e.row.piece=d,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),s(" 件/重量/体积包邮 ")]),_:2},1032,["prop"])):p("",!0)]),_:1})]),_:1},8,["data"])):p("",!0),l(t).isFreeFee==0?(i(),F("div",Le,[o(V,{type:"primary",icon:"el-icon-location-outline",onClick:r[5]||(r[5]=e=>x())},{default:a(()=>[s(" 点击添加指定包邮条件 ")]),_:1})])):p("",!0)]),_:1},8,["model"]),l(L)?(i(),f(Q,{key:0,ref_key:"addOrUpdateRef",ref:y,onRefreshDataList:m},null,512)):p("",!0)]),_:1},8,["modelValue","title"])}}},Q=_e(Pe,[["__scopeId","data-v-6aa461aa"]]),Ie={class:"mod-transport"},wt={__name:"index",setup(X){const N=b([]),P=b([]),C=b({total:0,currentPage:1,pageSize:10}),_=(m,c,k)=>{v({url:v.adornUrl("/shop/transport/page"),method:"get",params:v.adornParams(Object.assign({current:m==null?C.value.currentPage:m.currentPage,size:m==null?C.value.pageSize:m.pageSize},c))}).then(({data:y})=>{N.value=y.records,C.value.total=y.total,k&&k()})},t=b(!1),O=b(null),h=m=>{t.value=!0,z(()=>{var c;(c=O.value)==null||c.init(m)})},L=m=>{var k;const c=m?[m]:(k=P.value)==null?void 0:k.map(y=>y.transportId);me.confirm(`确定进行[${m?"删除":"批量删除"}]操作?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v({url:v.adornUrl("/shop/transport"),method:"delete",data:v.adornData(c,!1)}).then(()=>{S({message:"操作成功",type:"success",duration:1500,onClose:()=>{_()}})})}).catch(()=>{})},I=(m,c)=>{_(C.value,m,c)},M=m=>{P.value=m};return(m,c)=>{const k=J,y=Y,B=Ce("avue-crud");return i(),F("div",Ie,[o(B,{ref:"crudRef",page:l(C),data:l(N),option:l(ke),onSearchChange:I,onSelectionChange:M,onOnLoad:_},{"prod-prop-values":a(x=>[(i(!0),F(R,null,q(x.row.prodPropValues,T=>(i(),f(k,{key:T.valueId},{default:a(()=>[s(A(T.propValue),1)]),_:2},1024))),128))]),"menu-left":a(()=>[l(U)("shop:transport:save")?(i(),f(y,{key:0,type:"primary",icon:"el-icon-plus",onClick:c[0]||(c[0]=E(x=>h(),["stop"]))},{default:a(()=>[s(" 新增 ")]),_:1})):p("",!0),l(U)("shop:transport:delete")?(i(),f(y,{key:1,type:"danger",disabled:l(P).length<=0,onClick:c[1]||(c[1]=x=>L())},{default:a(()=>[s(" 批量删除 ")]),_:1},8,["disabled"])):p("",!0)]),menu:a(x=>[l(U)("shop:transport:update")?(i(),f(y,{key:0,type:"primary",icon:"el-icon-edit",onClick:E(T=>h(x.row.transportId),["stop"])},{default:a(()=>[s(" 修改 ")]),_:2},1032,["onClick"])):p("",!0),l(U)("shop:transport:delete")?(i(),f(y,{key:1,type:"danger",icon:"el-icon-delete",onClick:E(T=>L(x.row.transportId),["stop"])},{default:a(()=>[s(" 删除 ")]),_:2},1032,["onClick"])):p("",!0)]),_:1},8,["page","data","option"]),l(t)?(i(),f(Q,{key:0,ref_key:"addOrUpdateRef",ref:O,onRefreshDataList:_},null,512)):p("",!0)])}}};export{wt as default};
