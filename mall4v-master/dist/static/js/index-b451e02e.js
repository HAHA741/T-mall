import{a as P,c as j,b as A,J as G,S as K,G as W,H,d as J,e as D,f as Y,g as Q}from"./element-plus@2.3.6_vue@3.2.47-2ccbbec5.js";import{b as X,w as E}from"./@vue_runtime-dom@3.2.47-65c92196.js";import{h as u,e as Z,f as ee,b as te,a as k}from"./index-ac6793f4.js";import{D as oe}from"./debounce-d39f6322.js";import{r as b,j as N,u as o,i as re}from"./@vue_reactivity@3.2.47-b35eb3c0.js";import{o as f,K as g,L as l,a as le,e as i,P as c,c as $,F as ae,W as se,n as R,O as V,Y as ie}from"./@vue_runtime-core@3.2.47-7772318f.js";import{q as B,O as ne}from"./@vue_shared@3.2.47-804b7488.js";import"./lodash-es@4.17.21-53d52778.js";import"./@vue-eb92069c.js";import"./@ctrl_tinycolor@3.6.1-93e5f6fc.js";import"./@vueuse_core@9.13.0_vue@3.2.47-f8689e2f.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-4c633672.js";import"./@element-plus_icons-vue@2.1.0_vue@3.2.47-c959b2bd.js";import"./@sxzz_popperjs-es@2.11.7-eb0a044a.js";import"./dayjs@1.11.13-e8f4b8a8.js";import"./async-validator@4.2.5-940bb5fd.js";import"./memoize-one@6.0.0-43ba193c.js";import"./escape-html@1.0.3-d65727e0.js";import"./normalize-wheel-es@1.2.0-fb80f16a.js";import"./@floating-ui_dom@1.6.12-11ac7818.js";import"./@floating-ui_core@1.6.8-010b5758.js";import"./@floating-ui_utils@0.2.8-6db9c233.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-d8bd5cdb.js";import"./vue@3.2.47-3eac09d8.js";import"./pinia@2.0.33_vue@3.2.47-da3f2561.js";import"./vue-demi@0.14.10_vue@3.2.47-71ba0ef2.js";import"./moment@2.29.4-4717c495.js";import"./vue-router@4.1.6_vue@3.2.47-3725844c.js";import"./vue-cookies@1.8.3-b35a0960.js";import"./axios@1.3.4-4a7005d9.js";import"./qs@6.11.1-8e85f023.js";import"./side-channel@1.0.6-025da103.js";import"./get-intrinsic@1.2.4-25c259ca.js";import"./es-errors@1.3.0-82fd953f.js";import"./has-symbols@1.0.3-8f82dcae.js";import"./has-proto@1.0.3-1353c55e.js";import"./function-bind@1.1.2-61637ca6.js";import"./hasown@2.0.2-42bc0a75.js";import"./call-bind@1.0.7-82cb89a2.js";import"./set-function-length@1.2.2-7418ecdf.js";import"./define-data-property@1.1.4-53ade537.js";import"./es-define-property@1.0.0-8178d4b8.js";import"./gopd@1.0.1-6433dd40.js";import"./has-property-descriptors@1.0.2-f195ed7c.js";import"./object-inspect@1.13.3-0d0634c3.js";import"./crypto-js@4.1.1-0f0eb29b.js";import"./lodash@4.17.21-08c1e7a6.js";import"./@smallwei_avue@3.5.6_element-plus@2.3.6_vue@3.2.47-c4df20a4.js";const de={searchMenuSpan:6,columnBtn:!1,border:!0,selection:!0,index:!1,indexLabel:"序号",stripe:!0,menuAlign:"center",menuWidth:350,align:"center",refreshBtn:!0,searchSize:"mini",addBtn:!1,editBtn:!1,delBtn:!1,viewBtn:!1,props:{label:"label",value:"value"},column:[{label:"用户名",prop:"username",search:!0},{label:"邮箱",prop:"email"},{label:"手机号",prop:"mobile"},{label:"创建时间",prop:"createTime"},{label:"状态",prop:"status",type:"select",dicData:[{label:"禁用",value:0},{label:"正常",value:1}]}]},ue={class:"dialog-footer"},me={__name:"add-or-update",emits:["refreshDataList"],setup(O,{expose:h,emit:C}){const m=b(!1),t=N({id:0,userName:"",password:"",comfirmPassword:"",email:"",mobile:"",roleIdList:[],status:1}),L={userName:[{required:!0,message:"用户名不能为空",trigger:"blur"},{pattern:/\s\S+|S+\s|\S/,message:"请输入正确的用户名",trigger:"blur"}],password:[{validator:(s,e,r)=>{!t.id&&!/\S/.test(e)?r(new Error("密码不能为空")):r()},trigger:"blur"}],comfirmPassword:[{validator:(s,e,r)=>{!t.id&&!/\S/.test(e)?(t.password="",r(new Error("确认密码不能为空"))):t.password!==e?r(new Error("确认密码与密码输入不一致")):r()},trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{validator:(s,e,r)=>{ee(e)?r():r(new Error("邮箱格式错误"))},trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"},{validator:(s,e,r)=>{te(e)?r():r(new Error("手机号格式错误"))},trigger:"blur"}]},w=b([]),v=b(null);h({init:s=>{t.id=s||0,u({url:u.adornUrl("/sys/role/list"),method:"get",params:u.adornParams()}).then(({data:e})=>{w.value=e}).then(()=>{m.value=!0,R(()=>{var e;(e=v.value)==null||e.resetFields()})}).then(()=>{t.id&&u({url:u.adornUrl(`/sys/user/info/${t.id}`),method:"get",params:u.adornParams()}).then(({data:e})=>{t.userName=e.username,t.email=e.email,t.mobile=e.mobile,t.roleIdList=e.roleIdList,t.status=e.status})})}});const n=oe(()=>{var s;(s=v.value)==null||s.validate(e=>{e&&u({url:u.adornUrl("/sys/user"),method:t.id?"put":"post",data:u.adornData({userId:t.id||void 0,username:t.userName,password:Z(t.password),email:t.email,mobile:t.mobile,status:t.status,roleIdList:t.roleIdList})}).then(()=>{P({message:"操作成功",type:"success",duration:1500,onClose:()=>{m.value=!1,C("refreshDataList")}})})})});return(s,e)=>{const r=j,p=A,F=G,M=K,S=W,q=H,z=J,U=D,T=Y;return f(),g(T,{modelValue:o(m),"onUpdate:modelValue":e[10]||(e[10]=a=>re(m)?m.value=a:null),title:o(t).id?"修改":"新增","close-on-click-modal":!1},{footer:l(()=>[le("span",ue,[i(U,{onClick:e[8]||(e[8]=a=>m.value=!1)},{default:l(()=>[c("取消")]),_:1}),i(U,{type:"primary",onClick:e[9]||(e[9]=a=>o(n)())},{default:l(()=>[c("确定")]),_:1})])]),default:l(()=>[i(z,{ref_key:"dataFormRef",ref:v,model:o(t),rules:L,"label-width":"80px",onKeyup:e[7]||(e[7]=X(a=>o(n)(),["enter"]))},{default:l(()=>[i(p,{label:"用户名",prop:"userName"},{default:l(()=>[i(r,{modelValue:o(t).userName,"onUpdate:modelValue":e[0]||(e[0]=a=>o(t).userName=a),placeholder:"登录帐号"},null,8,["modelValue"])]),_:1}),i(p,{label:"密码",prop:"password",class:B({"is-required":!o(t).id})},{default:l(()=>[i(r,{modelValue:o(t).password,"onUpdate:modelValue":e[1]||(e[1]=a=>o(t).password=a),type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1},8,["class"]),i(p,{label:"确认密码",prop:"comfirmPassword",class:B({"is-required":!o(t).id})},{default:l(()=>[i(r,{modelValue:o(t).comfirmPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>o(t).comfirmPassword=a),type:"password",placeholder:"确认密码"},null,8,["modelValue"])]),_:1},8,["class"]),i(p,{label:"邮箱",prop:"email"},{default:l(()=>[i(r,{modelValue:o(t).email,"onUpdate:modelValue":e[3]||(e[3]=a=>o(t).email=a),placeholder:"邮箱"},null,8,["modelValue"])]),_:1}),i(p,{label:"手机号",prop:"mobile"},{default:l(()=>[i(r,{modelValue:o(t).mobile,"onUpdate:modelValue":e[4]||(e[4]=a=>o(t).mobile=a),maxlength:"11",placeholder:"手机号"},null,8,["modelValue"])]),_:1}),i(p,{label:"角色",prop:"roleIdList"},{default:l(()=>[i(M,{modelValue:o(t).roleIdList,"onUpdate:modelValue":e[5]||(e[5]=a=>o(t).roleIdList=a)},{default:l(()=>[(f(!0),$(ae,null,se(o(w),a=>(f(),g(F,{key:a.roleId,label:a.roleId},{default:l(()=>[c(ne(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(p,{label:"状态",prop:"status"},{default:l(()=>[i(q,{modelValue:o(t).status,"onUpdate:modelValue":e[6]||(e[6]=a=>o(t).status=a)},{default:l(()=>[i(S,{label:0},{default:l(()=>[c(" 禁用 ")]),_:1}),i(S,{label:1},{default:l(()=>[c(" 正常 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},pe={class:"mod-user"},it={__name:"index",setup(O){const h=b([]),C=b(!1),m=b([]),t=b(!1),_=N({total:0,currentPage:1,pageSize:10}),y=(d,n,s)=>{C.value=!0,u({url:u.adornUrl("/sys/user/page"),method:"get",params:u.adornParams(Object.assign({current:d==null?_.currentPage:d.currentPage,size:d==null?_.pageSize:d.pageSize},n))}).then(({data:e})=>{h.value=e.records,_.total=e.total,C.value=!1,s&&s()})},x=(d,n)=>{y(_,d,n)},I=d=>{m.value=d},L=b(null),w=d=>{t.value=!0,R(()=>{var n;(n=L.value)==null||n.init(d)})},v=d=>{var s;const n=d?[d]:(s=m.value)==null?void 0:s.map(e=>e.userId);Q.confirm(`确定对[id=${n.join(",")}]进行[${d?"删除":"批量删除"}]操作?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u({url:u.adornUrl("/sys/user"),method:"delete",data:u.adornData(n,!1)}).then(()=>{P({message:"操作成功",type:"success",duration:1500,onClose:()=>{y()}})})}).catch(()=>{})};return(d,n)=>{const s=D,e=ie("avue-crud");return f(),$("div",pe,[i(e,{ref:"crudRef",page:o(_),data:o(h),option:o(de),onSearchChange:x,onSelectionChange:I,onOnLoad:y},{"menu-left":l(()=>[o(k)("sys:user:save")?(f(),g(s,{key:0,type:"primary",icon:"el-icon-plus",onClick:n[0]||(n[0]=E(r=>w(),["stop"]))},{default:l(()=>[c(" 新增 ")]),_:1})):V("",!0),o(k)("sys:user:delete")?(f(),g(s,{key:1,type:"danger",disabled:o(m).length<=0,onClick:n[1]||(n[1]=r=>v())},{default:l(()=>[c(" 批量删除 ")]),_:1},8,["disabled"])):V("",!0)]),menu:l(r=>[o(k)("sys:user:update")?(f(),g(s,{key:0,type:"primary",icon:"el-icon-edit",onClick:E(p=>w(r.row.userId),["stop"])},{default:l(()=>[c(" 编辑 ")]),_:2},1032,["onClick"])):V("",!0),o(k)("sys:user:delete")?(f(),g(s,{key:1,type:"danger",icon:"el-icon-delete",onClick:E(p=>v(r.row.userId),["stop"])},{default:l(()=>[c(" 删除 ")]),_:2},1032,["onClick"])):V("",!0)]),_:1},8,["page","data","option"]),o(t)?(f(),g(me,{key:0,ref_key:"addOrUpdateRef",ref:L,onRefreshDataList:y},null,512)):V("",!0)])}}};export{it as default};
